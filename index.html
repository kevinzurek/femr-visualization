<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>d3 geoJSON testing</title>
        <script type="text/javascript" src="js/d3.js"></script>
	<style>
		div.bar{
			display: inline-block;
			width: 20px;
			height: 75px;
			background-color: teal;
			margin-right: 2px;
		}
		svg .pumpkin{
			fill: yellow;
			stroke: orange;
			stroke-width: 5;
		}
	</style>
    </head>
    <body>
        <script type="text/javascript">
            

		var width = 850;
		var height = 450;			
		var svg = d3.select("body").append("svg").attr({width:width, height: height});

		drawCountries("geographical_data/countries.json", svg, width, height);		
		outlineMap(svg, width, height)
		drawCircles("test_data/haiti-test-data.csv", svg, width, height);


	
		//draws the geoJSON coordinates from the file provided
		function drawCountries(file, svg, width, height){

			var scale = 7500;
		
			d3.json(file, function(json) {
	
				var offset = [width/2, height/2];
				var center = d3.geo.centroid(json);
				var projection = d3.geo.mercator().center(center).scale(scale).translate(offset);
				var path = d3.geo.path().projection(projection);
		
		
				svg.selectAll("path")
					.data(json.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style('stroke', 'black')
					.style('fill', 'pink');
			});
		}

		//draws a rectangle around the available space to help identify boundaries
		function outlineMap(svg, width, height){

			svg.append("rect")
				.attr('width', width)
				.attr('height', height)
				.style('stroke', 'black')
				.style('fill', 'none');
		}
	
		//draws circles based on the location of cities and how many patients have been
		//seen in those cities. (work in progress). Extracts the information from a csv
		//file
		function drawCircles(file, svg, width, height){
			d3.csv(file, function(csv) {
		


			//var projection = d3.geo.mercator().center(center).scale(scale).translate(offset);
			//need to build a proper projection for these points
			svg.selectAll("circle")
				.data(csv)
				.enter()
				.append("circle")
				.attr("cx", function(d){
	//				return projection([d.lon, d.lat])[0];
					return [d.lon, d.lat][0];
				})
				.attr("cy", function(d){
//					return projection([d.lon, d.lat])[1];
					return [d.lon, d.lat][1];
				})
				.attr("r", 5)
				.style("fill", "yellow")
				.style("opacity", "0.75");
			});
		}


        </script>
    </body>
</html>     
